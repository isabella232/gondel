!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).gondel={})}(this,function(n){"use strict";var u=function(n,e,t){return t(n)},e=window.__gondelPluginEvents||{pluginMapping:{},pluginEvents:{}},i=(window.__gondelPluginEvents=e).pluginEvents,f=e.pluginMapping;function s(n,e,t,o){var r,c=!1;if((i[n]||u)(e,t,function(n){c=!0,r=o?o(n):n}),!c)throw new Error("Async plugin listener");return r}function t(n,e,c){var t,n="".concat(e,"#").concat(n);f[n]||(f[n]=!0,i[e]||(i[e]=u),t=i[e],i[e]=function(n,o,r){t(n,o,function(n,e,t){c(n,o,function(n){r(n,o,t)})})})}function d(n,e,t,o,r){void 0===o&&(o={}),void 0===r&&(r=!0);var c=document.createEvent("Event"),t=t?p(t):e._ctx,i=e._namespace;if(n.substr(0,i.length)!==i)throw new Error("Invalid event name '"+n+"' - use '"+i+n.charAt(0).toUpperCase()+n.slice(1)+"'");return c.initEvent(n,r,!0),c.data={component:e,name:e._componentName,namespace:e._namespace,eventData:o},t.dispatchEvent(c)}function m(){}var l=function(){var e=this;this.promise=new Promise(function(n){e.resolve=n})};function v(r,n,c){var e,t,o=Array.prototype.slice.call(n.querySelectorAll("[data-".concat(c,"-name]"))),n=(n.hasAttribute("data-".concat(c,"-name"))&&o.push(n),o.filter(function(n){return!n.hasOwnProperty(w+c)})),i=new l,a=(n.forEach(function(n){var e;e=i.promise,n[w+c]=e}),s("boot",n,{namespace:c},function(n){return n.map(function(n){var e=r,t=c,o=n.getAttribute("data-".concat(t,"-name"));if(void 0===(e=e.getComponent(o)))throw new Error("Failed to boot component - ".concat(o," is not registred"));return(e=new e(n,o))._ctx=n,e._namespace=t,e._componentName=o,e.stop=function(n,e,t){d("".concat(t,"Stop"),n,n._ctx),delete n._ctx[E+t],delete n._ctx[w+t],n._stopped=!0,s("stop",n,{namespace:t},e.bind(n))}.bind(null,e,e.stop||m,t),n["_gondel_"+t]=e})})),o=(e=r,t={},a.forEach(function(n){return t[n._componentName]=!0}),Object.keys(t).filter(function(n){return!e._activeComponents[n]})),u=(o.forEach(function(n){return r.setActiveState(n,!0)}),s("start",a,{newComponentNames:o,namespace:c,gondelComponentRegistry:r},function(n){return Promise.all(n.map(g))}).then(function(){return a.forEach(function(n){n.sync&&n.sync()}),s("sync",a,{namespace:c})}));return u.then(i.resolve,i.resolve).then(function(){return u}),u}function g(t){if(t.start)return 0===t.start.length?t.start():new Promise(function(n,e){return t.start(n,e)})}var o,h="__ðŸš¡Registries",_=(r.prototype.registerComponent=function(n,e){this._components[n]=e},r.prototype.unregisterComponent=function(n){delete this._components[n]},r.prototype.getComponent=function(n){return this._components[n]},r.prototype.setActiveState=function(n,e){this._activeComponents[n]=e},r.prototype.setBootMode=function(n){this._bootMode=n},r);function r(){this._components={},this._activeComponents={},this._bootMode=2}function c(n){function e(){Promise.resolve().then(function(){var n=c(t);2===n._bootMode&&(n.setBootMode(0),v(n,document.documentElement,t))})}var t;return o||(o=window[h]||{},window[h]=o),o[n]||(o[n]=new _,t=n,"complete"==document.readyState?e():document.addEventListener("DOMContentLoaded",e,!1)),o[n]}function y(){var n=arguments,e=n[0],t="string"==typeof n[1]?n[1]:"g",n=n[n.length-1],o=c(t);o.getComponent(e)&&s("unregister",n,{componentName:e,namespace:t}),s("register",n,{componentName:e,namespace:t,gondelComponentRegistry:o},function(n){o.registerComponent(e,n)})}var E="_gondel_",w="_gondelA_";function p(n){return void 0!==n.nodeType?n:n[0]}function b(n,e){n=p(n)[E+(e=void 0===e?"g":e)];return!(!n||!n._ctx)}function C(n,e){n=x(p(n),e=void 0===e?"g":e);if(!n)throw new Error('Could not find a started gondel component in namespace "'.concat(e,"\",\nplease check if your component is mounted via 'hasMountedGondelComponent'"));return n}function x(n,e){n=n[E+e];if(n&&n._ctx)return n}function M(n,e,t){for(var n=p(n=void 0===n?document.documentElement:n),o=[],r="_gondel_".concat(t=void 0===t?"g":t),c=n.querySelectorAll("[data-".concat(t,"-name").concat(e?'="'.concat(e,'"'):"","]")),i=0;i<c.length;i++){var a=c[i],u=a[r];u&&u._ctx===a&&o.push(u)}return o}var a,N={focus:"focusin",blur:"focusout"},P=function(n,e){var t=window.Element.prototype,o=t.matches||t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.webkitMatchesSelector;return(P=function(n,e){return o.call(n,e)})(n,e)};function A(t,o,n){var r=function(n){for(var e=[],t=n;t;t=t.parentElement)e.push(t);return e}(n),c=[],i=(r.forEach(function(n,e){n=n.getAttribute(t),n=n&&o[n];n&&c.push({index:e,handlers:n})}),[]);return c.forEach(function(n){var t=n.index,o=n.handlers;Object.keys(o).forEach(function(n){if(!n)return i.push({index:t,ctx:r[t],target:r[t],handlerOptions:o[n]});for(var e=t;0<=--e;)if(P(r[e],n))return i.push({index:e,ctx:r[t],target:r[e],handlerOptions:o[n]})})}),0===i.length?[]:(i.sort(function(n,e){return n.index>e.index?1:n.index===e.index?0:-1}),i)}function O(n,e,t,o){for(var i=A(e,t,o.target),a=o,u=n,s=!1,p=[],r=0;r<i.length&&!a.cancelBubble;r++)!function(n){var e=i[n],t=e.handlerOptions,o=x(e.ctx,u);if(o){Object.defineProperty(a,"currentTarget",{get:function(){return e.target},configurable:!0}),s=!0;for(var r=0;r<t.length&&!a.cancelBubble;r++){var c=o[t[r].handlerName].call(o,a);"function"==typeof c&&p.push(c)}}}(r);p.forEach(function(n){n()}),s&&delete a.currentTarget}function S(n){return a||(a=window["__ðŸš¡DomEvents"]||{},window["__ðŸš¡DomEvents"]=a),a[n]||(a[n]={}),a[n]}function D(t,o,n,e,r){var c=S(t);c[o]||(c[o]={},s("registerEvent",!0,{eventName:o,namespace:t,eventRegistry:c[o]},function(n){var e;n&&(n=o,e=t,document.documentElement.addEventListener(N[n]||n,O.bind(null,e,"data-".concat(e,"-name"),S(e)[n])))})),c[o][n]||(c[o][n]={});var i=("object"==typeof r?r:{selector:r}).selector||"";c[o][n][i]||(c[o][n][i]=[]),c[o][n][i].push(Object.assign({handlerName:e,handlerOption:r}))}function j(){t("GondelDecorators","register",function(n,e,t){var o=e.componentName,r=e.namespace;if(!e.gondelComponentRegistry._activeComponents[o])return t(n);e=n.prototype&&n.prototype.__events||n.__events;e&&e.forEach(function(n){D(r,n[0],o,n[1],n[2])}),t(n)}),t("GondelDecorators","unregister",function(n,e,t){var o,r=e.componentName,e=e.namespace,c=r,i=S(e);for(o in i)i.hasOwnProperty(o)&&delete i[o][c];t(n)}),t("GondelDecorators","start",function(n,e,t){var o=e.newComponentNames,r=e.gondelComponentRegistry,c=e.namespace;o.forEach(function(e){var n=r.getComponent(e),n=n.prototype&&n.prototype.__events||n.__events;n&&n.forEach(function(n){D(c,n[0],e,n[1],n[2])})}),t(n)})}B.prototype.stop=function(){};e=B;function B(n,e){}n.Component=function(e,t){return function(n){y(e,t,n)}},n.EventListener=function(t,o){return function(n,e){if(j(),"_"!==e.substr(0,1))throw new Error("Invalid handler name '".concat(e,"' use '_").concat(e,"' instead."));n.__events||(n.__events=[]),n.__events.push([t,e,o])}},n.GondelBaseComponent=e,n.addGondelPluginEventListener=t,n.disableAutoStart=function(n){c(n=void 0===n?"g":n).setBootMode(1)},n.findComponents=M,n.getComponentByDomNode=C,n.getComponentByDomNodeAsync=function(n,e){void 0===e&&(e="g");var t=p(n);return(n=t[w+e])?n._ctx?Promise.resolve(n):n.then(function(){return t[E+e]}):Promise.reject(void 0)},n.getFirstDomNode=p,n.hasMountedGondelComponent=b,n.registerComponent=y,n.startComponents=function(n,e){return v(c(e=void 0===e?"g":e),n?p(n):document.documentElement,e)},n.stopComponents=function(n,e){e=M(n,void 0,e=void 0===e?"g":e),n&&b(n)&&e.unshift(C(n)),e.forEach(function(n){return n.stop()})},n.triggerPublicEvent=d,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=gondel.es5.min.js.map
